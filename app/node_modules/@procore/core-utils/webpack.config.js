const path = require('path')
const webpack = require('webpack')
const {
  addPlugins,
  babel,
  createConfig,
  customConfig,
  entryPoint,
  env,
  file,
  match,
  resolve,
  sass,
  setOutput,
  sourceMaps,
  uglify,
} = require('webpack-blocks')

const package = require('./package.json')

module.exports = createConfig([
  entryPoint('./src/index.js'),

  setOutput({
    filename: 'index.js',
    path: path.resolve('./build'),
    libraryTarget: 'umd',
  }),

  resolve({ extensions: ['.js', '.jsx', '.css'] }),

  babel(),

  env('development', [sourceMaps()]),
  env('production', [
    uglify(),
    addPlugins([
      new webpack.BannerPlugin({
        banner: `${package.name} v${
          package.version
        } (https://procore.github.io/core/latest/react)\nCopyright (c) 2018 Procore Technologies, Inc.`,
      }),
    ]),
  ]),

  customConfig({
    externals: { react: 'umd react', 'react-dom': 'umd react-dom' },
  }),
])
